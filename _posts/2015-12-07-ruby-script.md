---
layout: post
title: Ruby でスクリプトを書くときに気をつけること
categories: [general]
tags: [demo]
fullview: true
---

## できるだけクラスを作る

抽象化して使い回すって言う意味もあるけど、メインのスクリプトから切り離す効果もある。スクリプト如きで複数のファイルにまたがらせるのもと思っていたけど、機能ごとに分担されていて、修正しやすかったり、バグが入った時に見つけやすかったりする。メインクラスは多くても100行ぐらいで収まるように心がけている。(あとから、修正するときに多かったら気が滅入る。)

## 毎日行うcronタスクとして登録するスクリプト

失敗した時に、Slack で通知するようにする。

## 引数について

TODO

## こまめに経過を出力する

`puts "doing something"` をこまめに入れる。何が起こっているのかわかるから。失敗したにせよ、どこまで実行されてて、どの辺りで実行が失敗したのか、検討がつけやすくなる。

## よく使うgem

- [retryable](https://github.com/kamui/retriable) - ネットワーク関連の処理でたまに失敗するとかがある部分
- [parallel](https://github.com/grosser/parallel) - 処理に時間がかかる部分
- [benchmark](http://qiita.com/scivola/items/c5b2aeaf7d67a9ef310a) - どれくらいかかっているのか測って分析するため、実行時間が長くて、時間を無駄にしていることをちゃんと認識する目的もある
- [colored](https://github.com/defunkt/colored) - 出力に色付けするために使う

## Heroku で工夫していること

注意すること:
・メモリが小さい(512MBを超えると、警告が出る)
・Postgres SQL は Row が10000行までしかレコード保存できない

基本的に、スクリプトを動かす目的でしか、Herokuを使っていない(アプリケーションを動かすなどをしていない)ため、Herokuを限られた用途でしか使っていない。そのため、あまり必要以上の機能を触ることがなくあまり広くは知らない。ビルドパックのことや、他のアドオンのことなど。

## 備考: 関連するツール系

Heroku の Scheduler を使っている。
GoogleSpreadSheetに結果を反映させている事が多い。
そのための、ラッパークラスも作っている。

### 参考

・使いやすいシェルスクリプトを書く
http://deeeet.com/writing/2014/05/18/shell-template/
