---
layout: post
title: Ruby でスクリプトを書くときに気をつけること
categories: [general]
tags: [demo]
fullview: true
---

## できるだけクラスを作る

抽象化して使い回すって言う意味もあるけど、メインのスクリプトから切り離す効果もある。スクリプト如きで複数のファイルにまたがらせるのもと思っていたけど、機能ごとに分担されていて、修正しやすかったり、バグが入った時に見つけやすかったりする。メインクラスは多くても100行ぐらいで収まるようにこころがけている。(あとから、修正するときに多かったら気が滅入る。)

## 毎日行うcronタスクとして登録するスクリプト

失敗した時に、Slack で通知するようにする。

## よく使うgem

- retryable - ネットワーク関連の処理でたまに失敗するとかがある部分
- parallel - 処理に時間がかかる部分
- benchmark - どれくらいかかっているのか測って分析するため、実行時間が長くて、時間を無駄にしていることをちゃんと認識する目的もある
- colored - 出力に色付けするために使う

## Heroku で工夫していること

注意すること:
・メモリが小さい
・Postgres SQL は Row が10000行までしかレコード保存できない

## 備考: 関連するツール系

Heroku のSchedulerを使っている。
GoogleSpreadSheetに結果を反映させている事が多い。
そのための、ラッパークラスも作っている。

### 参考

・使いやすいシェルスクリプトを書く
http://deeeet.com/writing/2014/05/18/shell-template/
